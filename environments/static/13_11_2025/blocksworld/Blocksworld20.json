{
    "name": "Blocksworld20",
    "author": "Human",
    "agents": {
        "number": 4,
        "names": [
            "state_modeler",
            "plan_checker",
            "consistency_auditor",
            "orchestrator"
        ],
        "state_modeler": {
            "private_information": [
                "You specialize in turning natural language blocksworld descriptions into grounded symbolic states and abstract action templates.",
                "You avoid writing PDDL and instead output structured JSON describing objects, predicates, initial states, goal states, and verbal action templates."
            ],
            "goal": "Derive a consistent, symbol-grounded description of each scenario (objects, initial facts, goal facts) and high-level action templates from the public rules."
        },
        "plan_checker": {
            "private_information": [
                "You simulate plans step-by-step and check preconditions and effects under the provided rules.",
                "You report violations and propose minimal fixes while keeping within the allowed actions."
            ],
            "goal": "Validate the human-provided or empty plans against the initial conditions and rules; suggest minimal corrected plans if needed; do not emit PDDL."
        },
        "consistency_auditor": {
            "private_information": [
                "You audit temporal/causal consistency and remove bookkeeping shortcuts such as quota tokens or post-hoc penalties.",
                "You enforce invariants like exactly-one hand status (either handempty or holding exactly one block), block distinctness, and clear/stacking exclusivity.",
                "You output explicit action schemas with preconditions and effects in plain JSON to guide PDDL synthesis."
            ],
            "goal": "Produce a causally consistent set of invariants and action schemas aligned with the modeled states and validated plans; ensure no bookkeeping shortcuts; do not emit PDDL."
        },
        "orchestrator": {
            "private_information": [
                "You coordinate all agents and produce final PDDL artifacts targeting the Fast Downward planner.",
                "You integrate audited constraints and validated scenarios to synthesize a domain and problem files."
            ],
            "goal": "Produce a correct STRIPS PDDL domain and per-scenario problem files suitable for Fast Downward, consistent with the audited rules and validated states."
        }
    },
    "environment": {
        "init": {
            "solver": "FastDownward",
            "typing": "strips",
            "objects": {
                "blocks": [
                    "blue",
                    "yellow",
                    "red",
                    "orange"
                ]
            }
        },
        "public_information": [
            "Available actions: pick-up a block; unstack a block from on top of another block; put down a block; stack a block on top of another block.",
            "You can only pick up or unstack one block at a time.",
            "You can only pick up or unstack a block if your hand is empty.",
            "You can only pick up a block if the block is on the table and the block is clear.",
            "A block is clear if the block has no other blocks on top of it and if the block is not picked up.",
            "You can only unstack a block from on top of another block if the block you are unstacking was really on top of the other block.",
            "You can only unstack a block from on top of another block if the block you are unstacking is clear.",
            "Once you pick up or unstack a block, you are holding the block.",
            "You can only put down a block that you are holding.",
            "You can only stack a block on top of another block if you are holding the block being stacked.",
            "You can only stack a block on top of another block if the block onto which you are stacking is clear.",
            "Once you put down or stack a block, your hand becomes empty.",
            "Once you stack a block on top of a second block, the second block is no longer clear."
        ],
        "scenarios": [
            {
                "id": "scenario_1",
                "initial_conditions": [
                    "clear(blue)",
                    "clear(yellow)",
                    "handempty",
                    "on(red, orange)",
                    "on(yellow, red)",
                    "ontable(blue)",
                    "ontable(orange)"
                ],
                "goal_conditions": [
                    "on(red, orange)",
                    "on(blue, yellow)",
                    "on(yellow, red)"
                ],
                "human_plan": [
                    "pick-up(blue)",
                    "stack(blue, yellow)"
                ]
            },
            {
                "id": "scenario_2",
                "initial_conditions": [
                    "clear(blue)",
                    "clear(yellow)",
                    "handempty",
                    "on(orange, red)",
                    "on(yellow, orange)",
                    "ontable(red)",
                    "ontable(blue)"
                ],
                "goal_conditions": [
                    "on(blue, orange)",
                    "on(yellow, red)"
                ],
                "human_plan": []
            }
        ]
    },
    "workflow": {
        "state_modeler": {
            "extract_state": {
                "input": [],
                "output": "ground_facts",
                "system_prompt": "You are a blocks world analyst who converts natural language rules and scenarios into a grounded, symbolic description. Use objects: blue, yellow, red, orange. Use predicate templates: on(x, y), ontable(x), clear(x), holding(x), handempty. Provide JSON fields: objects, predicates, init_per_scenario (map from scenario id to list of facts), goal_per_scenario (map from scenario id to list of facts), action_templates (verbal, non-PDDL, with preconditions and effects). Do not write PDDL.",
                "prompt": "Your name is state_modeler. Use the public rules and scenarios to produce a consistent, symbol-grounded description for each scenario. Public rules: {environment->public_information}. Scenarios: {environment->scenarios}. Ensure consistent object names and no contradictions; do not add or remove blocks."
            }
        },
        "plan_checker": {
            "validate_plan": {
                "input": [
                    "ground_facts"
                ],
                "output": "plan_validation",
                "system_prompt": "You simulate plans under the blocks world rules with strict preconditions and effects, checking step-by-step feasibility and producing corrected minimal plans if the provided plan is invalid or incomplete. Do not write PDDL.",
                "prompt": "Your name is plan_checker. You will receive grounded states and goals: {ground_facts}. For each scenario, validate the human_plan if present; if missing or invalid, propose a minimal valid plan that achieves the goals from the initial state using only the allowed actions. Output JSON with per-scenario: validity, violations (if any), corrected_plan (if needed), and a final plan guaranteed to work under the rules."
            }
        },
        "consistency_auditor": {
            "audit_causality": {
                "input": [
                    "ground_facts",
                    "plan_validation"
                ],
                "output": "causal_audit",
                "system_prompt": "You audit temporal and causal consistency and remove bookkeeping shortcuts such as quota tokens or post-hoc penalties. Enforce invariants: unique hand status (either handempty or holding exactly one block), blocks are distinct, clear(x) iff no block on x and x is not being held, no cycles in on relation, and table is a distinct support. Produce JSON with invariants, state constraints, and action schemas for pick-up, put-down, stack, unstack written as readable preconditions/effects (not PDDL).",
                "prompt": "Your name is consistency_auditor. Use the grounded facts and validated plans to produce a causally consistent set of invariants and action schemas. Inputs: {ground_facts} and {plan_validation}. Ensure all preconditions/effects are closed under frame axioms; clarify enabling conditions; forbid multiple holdings; forbid stacking a block onto itself; and ensure that stacking clears and unstacking clears are updated correctly. Do not emit PDDL."
            }
        },
        "orchestrator": {
            "pddl": {
                "input": [
                    "ground_facts",
                    "plan_validation",
                    "causal_audit"
                ],
                "output": "pddl_orchestrator",
                "system_prompt": "You are an expert with PDDL for multi-problem synthesis targeting the Fast Downward solver. Produce a single STRIPS domain and two problem files (one per scenario) that are mutually consistent, solvable, and faithful to the audited action schemas and invariants. Use lowercase names, no negative preconditions, and no action costs. Enclose the PDDL domain between <domain></domain> tags, and enclose each PDDL problem between its own <problem></problem> tags. Ensure the problems are named scenario_1 and scenario_2, include the correct object list, and define initial and goal facts exactly as normalized by the upstream agents.",
                "prompt": "Coordinate all inputs to produce final PDDL. Inputs: Grounded facts {ground_facts}; Validated plans {plan_validation}; Causal audit and invariants {causal_audit}. Task: Synthesize a STRIPS PDDL domain with actions pick-up, put-down, stack, unstack aligned with the audited preconditions/effects, and two PDDL problem files corresponding to scenario_1 and scenario_2. Target Fast Downward compatibility. Keep to predicates: on, ontable, clear, holding, handempty. Ensure that at least one valid plan exists for each problem given the initial conditions and goals."
            }
        },
        "constraints": [
            "state_modeler.extract_state->plan_checker.validate_plan",
            "state_modeler.extract_state->consistency_auditor.audit_causality",
            "plan_checker.validate_plan->consistency_auditor.audit_causality",
            "state_modeler.extract_state->orchestrator.pddl",
            "plan_checker.validate_plan->orchestrator.pddl",
            "consistency_auditor.audit_causality->orchestrator.pddl"
        ]
    }
}