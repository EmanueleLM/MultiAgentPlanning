{
    "name": "TripPlanningExample16",
    "author": "Human",
    "agents": {
        "number": 4,
        "names": [
            "itinerary_planner",
            "flight_mapper",
            "consistency_auditor",
            "orchestrator"
        ],
        "itinerary_planner": {
            "private_information": [
                "Understands user preferences and hard constraints for trip planning.",
                "Capable of drafting city-by-day stay preferences and tagging hard vs soft constraints.",
                "Avoids producing PDDL; focuses on human-readable structured plans."
            ],
            "goal": "Draft a 9-day stay preference across Prague, Vienna, and Porto, tagging hard constraints (musts) and soft preferences (wants), given direct-flight-only commuting."
        },
        "flight_mapper": {
            "private_information": [
                "Knows how to convert route descriptions into an explicit symmetric direct-flight graph.",
                "Validates that commute legs only use direct flights.",
                "Avoids producing PDDL; produces structured connectivity data."
            ],
            "goal": "Build a symmetric direct-flight graph over the cities and flag infeasible legs that would require a connection."
        },
        "consistency_auditor": {
            "private_information": [
                "Audits temporal and causal consistency of multi-day itineraries.",
                "Enforces the total-day budget and hard constraints (e.g., workshop days in Prague).",
                "Disallows bookkeeping shortcuts such as quota tokens or post-hoc penalties; every day must be explicitly assigned to exactly one city.",
                "If preferences conflict with feasibility, proposes a minimal-deviation reconciliation."
            ],
            "goal": "Produce a reconciled, feasible per-day city assignment for 9 days that respects direct-flight constraints and hard requirements (Prague on days 1\u20133 for the workshop), and documents any deviation from the user's soft preferences."
        },
        "orchestrator": {
            "private_information": [
                "Coordinates agents' outputs to compile a final formal planning model.",
                "Knows how to produce PDDL domain and problem files suitable for the FastDownward solver."
            ],
            "goal": "Integrate the reconciled day-by-day assignment and the flight graph and emit the final PDDL domain and problem for FastDownward that achieves a 9-day feasible trip."
        }
    },
    "environment": {
        "init": {
            "time_horizon_days": 9,
            "cities": [
                "Prague",
                "Vienna",
                "Porto"
            ]
        },
        "public_information": [
            "Trip duration is exactly 9 consecutive days labeled Day 1 to Day 9.",
            "Must attend a workshop in Prague during days 1, 2, and 3 (inclusive).",
            "User wants to spend 3 days in Prague (hard due to workshop), 3 days in Vienna (planned), and 5 days in Porto (preference).",
            "Only direct flights are allowed between cities.",
            "Direct flights exist between Vienna and Porto (both directions) and between Prague and Vienna (both directions).",
            "There are no direct flights between Prague and Porto.",
            "The final itinerary must assign each of the 9 days to exactly one city and ensure transitions between consecutive days obey the direct-flight graph."
        ]
    },
    "workflow": {
        "itinerary_planner": {
            "propose_stays": {
                "input": [],
                "output": "stay_preferences",
                "system_prompt": "You are an expert travel itinerary planner. You will draft a 9-day, city-by-day stay preference using the user's wishes and hard constraints, clearly distinguishing hard constraints from soft preferences. Do not produce PDDL; produce a concise, structured JSON-like plan.",
                "prompt": "Your name is itinerary_planner. Given the public information {environment->public_information}, propose a structured stay preference for 9 days. Include: hard_constraints (e.g., total_days=9; Prague on days 1-3; direct_flights_only=true), soft_preferences (e.g., target_days_per_city: Prague=3, Vienna=3, Porto=5), and an initial city-day suggestion even if it violates feasibility (clearly tag any uncertainty). Output a single object called stay_preferences."
            }
        },
        "flight_mapper": {
            "map_direct_flights": {
                "input": [],
                "output": "flight_graph",
                "system_prompt": "You are a route analyst. Convert textual route descriptions into a symmetric direct-flight graph between cities. Do not produce PDDL.",
                "prompt": "Your name is flight_mapper. From the public information {environment->public_information}, output a symmetric direct-flight graph over the cities Prague, Vienna, Porto. Represent it as adjacency lists and an edge list. Output a single object called flight_graph."
            }
        },
        "consistency_auditor": {
            "audit_and_reconcile": {
                "input": [
                    "stay_preferences",
                    "flight_graph"
                ],
                "output": "reconciled_plan",
                "system_prompt": "You are a temporal/causal consistency auditor. You enforce exact 9-day budgeting, hard constraints (Prague on days 1\u20133), and direct-flight-only transitions between consecutive days. Remove bookkeeping shortcuts; ensure each day is explicitly assigned to exactly one city. If preferences conflict with feasibility, propose a minimal-deviation reconciliation and document the deviation.",
                "prompt": "Your name is consistency_auditor. Using the stay preferences {stay_preferences} and the direct-flight graph {flight_graph}, produce a reconciled per-day assignment for days 1..9 that is feasible with direct flights only. Anchor days 1\u20133 in Prague for the workshop. Since the total must be 9 days, reconcile the requested 3+3+5 distribution by minimally deviating from soft preferences; propose Prague: 3 days (days 1\u20133), Vienna: 3 days (e.g., 4\u20136), Porto: 3 days (e.g., 7\u20139), and list the flight legs needed (Prague->Vienna after day 3, Vienna->Porto after day 6). Output an object reconciled_plan with keys: day_assignments (map day->city), flights (ordered list of legs with from, to, and departure_day), hard_constraints_respected (boolean), deviations (list describing changes from soft preferences), and rationale."
            }
        },
        "orchestrator": {
            "compile_pddl": {
                "input": [
                    "reconciled_plan",
                    "flight_graph"
                ],
                "output": "pddl_orchestrator",
                "system_prompt": "You are an expert in multi-agent planning integration. Produce a final PDDL domain and problem targeting the FastDownward solver. The PDDL must encode: days d1..d9; cities prague, vienna, porto; a successor relation next(di, dj) over days; symmetric direct-flight relation direct(c1, c2) from the flight graph; workshop-day(d1), workshop-day(d2), workshop-day(d3); exactly-one-city-per-day assignment via sequential day planning; and transitions between consecutive days must either stay in the same city or use a direct flight. Start on day 1 in Prague due to the workshop requirement. Use actions to assign each day in sequence (e.g., assign-first-prague for day1, and assign-next-<city> for subsequent days). Maintain last-city predicates (last-is-prague, last-is-vienna, last-is-porto) to validate flight feasibility on city changes. Track numeric counts for days spent in each city (count-prague, count-vienna, count-porto). Goals: every day d1..d9 assigned; count-prague=3; count-vienna=3; count-porto=3; all constraints satisfied. Enclose the PDDL domain between <domain></domain> and the PDDL problem between <problem></problem> tags. Ensure FastDownward-compatible syntax.",
                "prompt": "Integrate the reconciled itinerary {reconciled_plan} with the direct-flight graph {flight_graph} and produce the final PDDL domain and problem for FastDownward. Encode cities {environment->init->cities} and days 1..9 (name them d1..d9). Enforce that days 1..3 are assigned to Prague, ensure every transition between consecutive days complies with the symmetric direct-flight relation, and satisfy the reconciled counts of 3 days per city. Provide only the PDDL enclosed within <domain></domain> and <problem></problem> tags."
            }
        },
        "constraints": [
            "itinerary_planner.propose_stays->consistency_auditor.audit_and_reconcile",
            "flight_mapper.map_direct_flights->consistency_auditor.audit_and_reconcile",
            "consistency_auditor.audit_and_reconcile->orchestrator.compile_pddl"
        ]
    }
}