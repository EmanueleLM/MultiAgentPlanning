{
    "name": "TripPlanningExample19",
    "author": "Human",
    "agents": {
        "number": 4,
        "names": [
            "route_planner",
            "duration_allocator",
            "auditor",
            "orchestrator"
        ],
        "route_planner": {
            "private_information": [
                "Interpret direct flights as bidirectional edges.",
                "Start city is unconstrained unless otherwise specified.",
                "Flights must be direct; no intermediate hidden hops are allowed."
            ],
            "goal": "Propose a feasible city visitation order using only direct flights that includes Brussels, Valencia, and Nice, and positions a Nice visit within days 1 to 6."
        },
        "duration_allocator": {
            "private_information": [
                "Total trip length is hard-capped at 9 days.",
                "Requested stays: Brussels 2 days, Valencia 3 days, Nice 6 days.",
                "If requests exceed the 9-day budget, resolve by minimal deviation from the requested stays while preserving the Nice meeting window feasibility."
            ],
            "goal": "Allocate exact day counts per city that sum to 9, adjusting requests only if necessary and documenting any deviations."
        },
        "auditor": {
            "private_information": [
                "Your role is to audit temporal and causal consistency.",
                "Eliminate bookkeeping shortcuts such as artificial quota tokens or post-hoc penalty devices; produce a concrete per-day itinerary instead.",
                "Validate that any change of city between consecutive days corresponds to a direct flight in the graph.",
                "Ensure that at least one day in the range [1..6] is spent in Nice."
            ],
            "goal": "Verify and, if needed, minimally repair the route and day allocations to produce a concrete per-day itinerary that satisfies direct-flight adjacency, the 9-day horizon, and the Nice meeting window."
        },
        "orchestrator": {
            "private_information": [
                "Integrate all upstream analyses and produce a single final PDDL domain and problem consumable by the FastDownward solver.",
                "Keep actions generic and avoid modeling artificial quota tokens; encode the audited itinerary as concrete per-day goals."
            ],
            "goal": "Orchestrate all inputs and output a final PDDL domain and problem that represent the 9-day itinerary planning task, using only direct flights between cities and ensuring the Nice-in-window requirement is met."
        }
    },
    "environment": {
        "init": {
            "days_total": 9,
            "cities": [
                "Brussels",
                "Valencia",
                "Nice"
            ],
            "direct_flights": [
                [
                    "Brussels",
                    "Valencia"
                ],
                [
                    "Nice",
                    "Brussels"
                ]
            ],
            "meeting": {
                "city": "Nice",
                "window_start": 1,
                "window_end": 6
            }
        },
        "public_information": [
            "Trip length is 9 days total.",
            "You plan to stay in Brussels for 2 days.",
            "You would like to visit Valencia for 3 days.",
            "You want to spend 6 days in Nice.",
            "Only direct flights may be used to commute between cities.",
            "You would like to meet your friends in Nice on at least one day between day 1 and day 6.",
            "Direct flights exist between Brussels and Valencia, and between Nice and Brussels."
        ]
    },
    "workflow": {
        "route_planner": {
            "analyze_routes": {
                "input": [],
                "output": "routes_plan",
                "system_prompt": "You are an expert travel route planner. Analyze the direct-flight graph and propose a viable city visitation order that uses only direct flights and includes all listed cities. Output a compact JSON with fields: cities_order (ordered list of city names), flight_legs (ordered list of [from, to] pairs), graph (list of undirected edges as [a, b] pairs), and rationale (short string). Do not emit PDDL.",
                "prompt": "Your name is route_planner. Public information: {environment->public_information}. Initialization: {environment->init}. Propose a city order that visits Brussels, Valencia, and Nice using only direct flights, and make it feasible to be in Nice at least once between days 1 and 6. Choose a reasonable start city and provide cities_order, flight_legs, graph, and a brief rationale as JSON."
            }
        },
        "duration_allocator": {
            "allocate_durations": {
                "input": [
                    "routes_plan"
                ],
                "output": "duration_plan",
                "system_prompt": "You allocate exact days per city to fit a fixed total while respecting preferences when jointly feasible. If requested city-day totals exceed the 9-day budget, resolve by minimal deviation from the requests and document the resolution clearly. Output JSON with fields: days_per_city (map city->int summing to total_days), total_days, deviations (describe any changes from requested values), meeting_window_city, meeting_window, and rationale.",
                "prompt": "Your name is duration_allocator. Public information: {environment->public_information}. Initialization: {environment->init}. Proposed route: {routes_plan}. Produce days_per_city that sum to 9 days. If the requested 2+3+6 conflicts with the 9-day limit, adjust with the smallest change needed and explain in deviations and rationale. Return the JSON fields described."
            }
        },
        "auditor": {
            "audit_temporal_causality": {
                "input": [
                    "routes_plan",
                    "duration_plan"
                ],
                "output": "audited_itinerary",
                "system_prompt": "You audit temporal and causal consistency and eliminate bookkeeping shortcuts. Validate that city changes between consecutive days occur only along direct-flight edges, that the total number of days equals the budget, that per-city totals match the resolved allocation, and that at least one day in the window [window_start..window_end] is spent in the specified meeting city. If infeasible, return status='error' with minimal explanation and suggested minimal repair. Otherwise return JSON with fields: status ('ok'), itinerary (array of objects with fields: day:int, city:string), flight_changes (list of objects with fields: between_day:int, from:string, to:string indicating the transition between day and day+1), checks (summary of validations), and notes.",
                "prompt": "Your name is auditor. Public information: {environment->public_information}. Initialization: {environment->init}. Proposed route: {routes_plan}. Proposed day allocation: {duration_plan}. Produce a concrete per-day itinerary for days 1..9 meeting all constraints, or report status='error' with a minimal repair suggestion. Avoid using artificial quota tokens; provide explicit per-day city assignments instead."
            }
        },
        "orchestrator": {
            "compile_pddl": {
                "input": [
                    "routes_plan",
                    "duration_plan",
                    "audited_itinerary"
                ],
                "output": "pddl_trip",
                "system_prompt": "You are an expert in compiling final PDDL domains and problems for the FastDownward planner. Use the audited itinerary to construct a solvable classical planning instance. Model cities and days as typed objects. Provide a STRIPS-style domain with predicates such as next(?d1 ?d2), assigned(?d), at(?d ?c), first(?d), and direct(?c1 ?c2). Include actions to assign the first day and each subsequent day, requiring that any change of city between consecutive days follows a direct edge; staying in the same city is allowed by including self direct edges. In the problem, include objects for cities and days d1..d9, initialize next and first, initialize direct according to the graph (including self edges), and set the goal as the exact audited per-day at(d, city) assignments for all days. Do not introduce quota-token constructs or soft constraints; encode the audited itinerary directly as the goal facts. Enclose the domain in <domain></domain> and the problem in <problem></problem> tags. Target the FastDownward solver with standard PDDL syntax.",
                "prompt": "You are the orchestrator. Integrate the following inputs to produce the final PDDL: Public information: {environment->public_information}. Initialization: {environment->init}. Route analysis: {routes_plan}. Duration allocation: {duration_plan}. Audited itinerary: {audited_itinerary}. Produce a single domain and problem pair enclosed in <domain></domain> and <problem></problem> tags as specified. Ensure the instance encodes the exact audited per-day city assignments and only permits changes between consecutive days along direct-flight edges."
            }
        },
        "constraints": [
            "route_planner.analyze_routes->duration_allocator.allocate_durations",
            "route_planner.analyze_routes->auditor.audit_temporal_causality",
            "duration_allocator.allocate_durations->auditor.audit_temporal_causality",
            "auditor.audit_temporal_causality->orchestrator.compile_pddl"
        ]
    }
}