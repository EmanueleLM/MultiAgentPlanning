{
    "name": "TripPlanningExample24",
    "author": "Human",
    "agents": {
        "number": 4,
        "names": [
            "planner",
            "connectivity_expert",
            "consistency_auditor",
            "orchestrator"
        ],
        "planner": {
            "private_information": [
                "I prefer to minimize the number of flights and avoid backtracking when possible.",
                "I treat the Florence 4-day stay and the workshop window on days 1 to 4 as hard constraints.",
                "I treat the Amsterdam 6-day and Riga 5-day preferences as soft constraints that can be adjusted to meet the 13-day total and connectivity constraints.",
                "Flights occur at day boundaries and do not create or destroy days."
            ],
            "goal": "Propose a feasible 13-day city sequence across Florence, Amsterdam, and Riga, starting in Florence to attend the workshop in days 1\u20134, using only direct flights."
        },
        "connectivity_expert": {
            "private_information": [
                "Only these direct flights exist: Florence\u2013Amsterdam and Amsterdam\u2013Riga.",
                "There is no direct Florence\u2013Riga flight; that route requires a connection in Amsterdam.",
                "City names must be normalized exactly as: florence, amsterdam, riga."
            ],
            "goal": "Provide a normalized, unambiguous direct-flight connectivity graph among Florence, Amsterdam, and Riga for planning and validation."
        },
        "consistency_auditor": {
            "private_information": [
                "I forbid non-causal shortcuts such as teleportation, fractional days, quota tokens, or post-hoc penalties.",
                "I enforce that total city-days equal exactly 13 with no overlaps or gaps and that moves occur only along direct flights.",
                "I ensure the workshop is attended in Florence within days 1\u20134 and that Florence totals 4 days."
            ],
            "goal": "Audit and, if needed, minimally repair the proposed itinerary so that it is temporally and causally consistent with the 13-day budget, direct-flight connectivity, and the workshop requirement."
        },
        "orchestrator": {
            "private_information": [
                "I integrate all agent outputs and compile the final PDDL domain and problem for FastDownward."
            ],
            "goal": "Produce a final, solver-ready PDDL domain and problem that encode the audited 13-day plan and constraints."
        }
    },
    "environment": {
        "init": {
            "days_total": 13,
            "cities": [
                "Florence",
                "Amsterdam",
                "Riga"
            ],
            "direct_flights": [
                [
                    "Florence",
                    "Amsterdam"
                ],
                [
                    "Amsterdam",
                    "Florence"
                ],
                [
                    "Amsterdam",
                    "Riga"
                ],
                [
                    "Riga",
                    "Amsterdam"
                ]
            ],
            "workshop_window_days": [
                1,
                2,
                3,
                4
            ],
            "hard_requirements": [
                "Stay in Florence for exactly 4 days.",
                "Attend a workshop in Florence on one of days 1\u20134.",
                "Use only direct flights to move between cities."
            ],
            "soft_preferences": [
                "Visit Amsterdam for 6 days if possible.",
                "Visit Riga for 5 days if possible."
            ],
            "start_city": "Florence"
        },
        "public_information": [
            "You plan to visit 3 European cities for 13 days in total: Florence, Amsterdam, and Riga.",
            "Only direct flights are allowed to commute between cities.",
            "Direct flights exist between Florence and Amsterdam, and between Amsterdam and Riga.",
            "There is no direct flight between Florence and Riga.",
            "You will stay in Florence for 4 days and must attend a workshop in Florence during days 1\u20134.",
            "You would like to visit Amsterdam for 6 days and Riga for 5 days, but the total must remain 13 days."
        ]
    },
    "workflow": {
        "planner": {
            "draft_itinerary": {
                "input": [],
                "output": "proposed_plan",
                "system_prompt": "You are a senior travel planner. Propose a feasible 13-day itinerary over Florence, Amsterdam, and Riga that starts in Florence and schedules the workshop in Florence within days 1\u20134, honoring only direct flights (Florence\u2013Amsterdam, Amsterdam\u2013Riga). Keep Florence at exactly 4 days as a hard constraint; treat Amsterdam 6 days and Riga 5 days as soft preferences to be adjusted as needed to fit 13 days. Minimize unnecessary flights and avoid backtracking.",
                "prompt": "Context: {environment->public_information}. Provide a compact JSON object containing: days_total, city_order (sequence of distinct city blocks in visit order), city_stays (map of city to number of days), daily_plan (array of objects with fields: day, city, events where events may include flight or workshop), and rationale. Ensure flights occur only at day boundaries and only between cities connected by a direct flight; do not emit PDDL."
            }
        },
        "connectivity_expert": {
            "graph_builder": {
                "input": [],
                "output": "flight_graph",
                "system_prompt": "You are a connectivity expert. Normalize city identifiers to lowercase tokens: florence, amsterdam, riga. Build the direct-flight graph using only the permitted edges: florence\u2013amsterdam and amsterdam\u2013riga. Provide both an undirected edge list and a directed adjacency list; reject any edge not in the allowed set.",
                "prompt": "Using the public information: {environment->public_information}. Output JSON with keys: cities (normalized list), edges_undirected (array of 2-tuples), adjacency_directed (object mapping city to list of neighbor cities). Do not emit PDDL."
            }
        },
        "consistency_auditor": {
            "consistency_audit": {
                "input": [
                    "proposed_plan",
                    "flight_graph"
                ],
                "output": "audited_plan",
                "system_prompt": "You audit temporal and causal consistency and remove bookkeeping shortcuts. Verify that the itinerary uses exactly 13 days with no overlaps or gaps, moves only along direct flights, keeps Florence at 4 days, and schedules attendance at a Florence workshop within days 1\u20134. Remove shortcuts such as teleportation, fractional days, placeholder tokens, quota tricks, or post-hoc penalties. If infeasible, minimally adjust soft preferences (Amsterdam and Riga days) while preserving hard constraints and direct-only movement.",
                "prompt": "Inputs: proposed plan {proposed_plan} and flight graph {flight_graph}. Validate and, if necessary, minimally repair the plan. Output JSON with keys: feasibility (boolean), issues (list of strings), fixes (list of strings), canonical_plan (array of day objects with day, city, events), city_stays (map city->days), flights (ordered list of legs with from, to, day), and justification. Do not emit PDDL."
            }
        },
        "orchestrator": {
            "pddl_compilation": {
                "input": [
                    "audited_plan",
                    "flight_graph"
                ],
                "output": "pddl_orchestrator",
                "system_prompt": "You are a multi-agent orchestrator. Integrate the audited plan and flight graph and produce a final STRIPS PDDL domain and problem compatible with FastDownward. Use typing and a finite day chain d1..d13 via a next predicate. Cities: florence, amsterdam, riga. Predicates to include at least: at_city(?c - city), on_day(?d - day), next(?d - day ?d2 - day), direct(?a - city ?b - city), must_be(?d - day ?c - city), satisfied(?d - day), workshop_window(?d - day), attended. Actions: stay to satisfy a day without moving, fly to move along a direct edge at a day boundary, and attend_workshop which can be taken on any day marked workshop_window while at florence. Initialize: on_day(d1), at_city(city_of_day1), the next chain, all direct edges, workshop_window for d1..d4, and must_be facts for each day per the audited plan; set no satisfied facts initially. Goal: all days d1..d13 are satisfied and attended is true. Enclose the PDDL domain in <domain></domain> and the PDDL problem in <problem></problem>. If the audited plan is infeasible, clearly state the issue and then provide the closest consistent PDDL instance based on your best minimal adjustments.",
                "prompt": "Public info: {environment->public_information}. Audited plan: {audited_plan}. Flight graph: {flight_graph}. Compile these into a solver-ready PDDL domain and problem for FastDownward using only STRIPS features and typing. Do not include natural language outside the required <domain> and <problem> blocks, except for a one-line note if you detected infeasibility."
            }
        },
        "constraints": [
            "planner.draft_itinerary->consistency_auditor.consistency_audit",
            "connectivity_expert.graph_builder->consistency_auditor.consistency_audit",
            "consistency_auditor.consistency_audit->orchestrator.pddl_compilation",
            "connectivity_expert.graph_builder->orchestrator.pddl_compilation",
            "planner.draft_itinerary->orchestrator.pddl_compilation"
        ]
    }
}