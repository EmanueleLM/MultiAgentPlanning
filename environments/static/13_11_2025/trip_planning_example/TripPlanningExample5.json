{
    "name": "TripPlanningExample5",
    "author": "Human",
    "agents": {
        "number": 4,
        "names": [
            "constraints_analyst",
            "route_planner",
            "consistency_auditor",
            "orchestrator"
        ],
        "constraints_analyst": {
            "private_information": [
                "You specialize in converting informal trip requirements into explicit, machine-checkable constraints.",
                "You distinguish hard constraints (must hold) from soft constraints (preferences) and annotate any interdependencies.",
                "You represent time discretely as whole days indexed 1..16 and treat each day as atomic (no half-days)."
            ],
            "goal": "Extract and formalize the trip specification into a consistent set of hard and soft constraints over cities, days, and flights."
        },
        "route_planner": {
            "private_information": [
                "You build candidate day-by-day itineraries that obey direct-flight connectivity and day-atomicity.",
                "You never assume teleportation between cities; a change of city from day d to day d+1 requires an available direct flight.",
                "When constraints are mutually incompatible, you keep candidates as close as possible to the original goals and clearly annotate deviations."
            ],
            "goal": "Propose 1-3 candidate itineraries that satisfy the formal constraints as much as possible while using only direct flights."
        },
        "consistency_auditor": {
            "private_information": [
                "You audit temporal and causal consistency, detect infeasible combinations, and propose minimal relaxations to restore feasibility.",
                "You remove bookkeeping shortcuts: no quota tokens, no fractional or split days, no being in two cities on the same day, no post-hoc penalties.",
                "You treat 'would like' statements as soft preferences that can be relaxed if they conflict with hard constraints."
            ],
            "goal": "Verify candidate itineraries against hard constraints, identify conflicts (e.g., day-count sums exceeding total days), and output a repaired, feasible specification with justifications."
        },
        "orchestrator": {
            "private_information": [
                "You integrate formal constraints, candidate itineraries, and the auditor's recommendations into a single coherent model.",
                "You generate the final PDDL domain and problem compatible with the Fast Downward planner (classical planning)."
            ],
            "goal": "Produce the final PDDL domain and problem that encode the feasible trip-planning task, honoring mandatory constraints and the auditor's minimal relaxations."
        }
    },
    "environment": {
        "init": {
            "days": 16,
            "cities": [
                "Oslo",
                "Porto",
                "Dubrovnik"
            ],
            "direct_flights": [
                [
                    "Oslo",
                    "Dubrovnik"
                ],
                [
                    "Porto",
                    "Oslo"
                ]
            ],
            "visibility": 1
        },
        "public_information": [
            "You plan a 16-day trip visiting Oslo, Porto, and Dubrovnik.",
            "You plan to stay in Oslo for 6 days (commitment).",
            "You plan to stay in Porto for 7 days (commitment).",
            "You would like to visit Dubrovnik for 5 days (preference).",
            "You must attend a conference in Dubrovnik on day 12 and on day 16 (hard constraints).",
            "Only direct flights may be used to commute between cities.",
            "Direct flights exist between Oslo and Dubrovnik, and between Porto and Oslo. There is no direct flight between Porto and Dubrovnik.",
            "Days are indexed 1..16, each day you are in exactly one city, and a city change from day d to day d+1 requires a direct flight between those cities.",
            "If total-day commitments exceed the 16-day horizon, soft preferences should be relaxed before hard commitments."
        ]
    },
    "workflow": {
        "constraints_analyst": {
            "formalize": {
                "input": [],
                "output": "formal_constraints",
                "system_prompt": "You are a constraints analyst for trip planning. Convert the human specification into an explicit set of hard constraints and soft preferences over days 1..16 and the cities {Oslo, Porto, Dubrovnik}. Identify variables, domains, and relations (presence-in-city per day, flight adjacency for day transitions, day-count goals per city, and must-be-in-city requirements for specific days). Mark which constraints are hard and which are soft. Do not emit PDDL; provide a clear, structured textual or JSON-like summary suitable for downstream integration.",
                "prompt": "Your name is constraints_analyst. Public information: {environment->public_information}. Your knowledge: {agents->constraints_analyst->private_information}. Goal: {agents->constraints_analyst->goal}. Provide a structured set of variables, hard constraints, and soft preferences capturing the problem, including explicit mention of days 12 and 16 in Dubrovnik and the direct-flight graph {Oslo<->Dubrovnik, Porto<->Oslo}. Flag any apparent conflicts but do not resolve them here."
            }
        },
        "route_planner": {
            "candidates": {
                "input": [
                    "formal_constraints"
                ],
                "output": "route_candidates",
                "system_prompt": "You generate concrete day-by-day itineraries that follow a direct-flight-only connectivity rule. When the city differs between consecutive days, ensure a direct flight edge exists. Propose up to three candidates that best satisfy the constraints; if any constraints conflict, keep a candidate that is closest to the goals and annotate deviations. Do not emit PDDL.",
                "prompt": "Your name is route_planner. Public information: {environment->public_information}. Your knowledge: {agents->route_planner->private_information}. Use the formal constraints: {formal_constraints}. Goal: {agents->route_planner->goal}. Output up to three candidate schedules mapping each day 1..16 to a city. When a city change occurs, annotate the required direct flight. If you cannot satisfy all city-day counts simultaneously, note the minimal deviations."
            }
        },
        "consistency_auditor": {
            "audit": {
                "input": [
                    "formal_constraints",
                    "route_candidates"
                ],
                "output": "audit_report",
                "system_prompt": "You audit temporal and causal consistency. Check for infeasibilities such as sum of city-day counts exceeding 16, or illegal city changes lacking a direct flight. You must remove bookkeeping shortcuts: no split days, no simultaneous presence in two cities, and no hand-waving tokens. When conflicts exist, propose the smallest relaxation that turns the problem feasible, prioritizing preservation of hard constraints (e.g., Dubrovnik on days 12 and 16) and treating the 5-day stay in Dubrovnik as a soft preference that may be reduced. Provide a repaired specification and one recommended feasible schedule.",
                "prompt": "Your name is consistency_auditor. Public information: {environment->public_information}. Your knowledge: {agents->consistency_auditor->private_information}. Inputs: {formal_constraints} and {route_candidates}. Goal: {agents->consistency_auditor->goal}. Identify conflicts (for example, 6+7+5 > 16) and propose a minimal relaxation that preserves Oslo=6 days and Porto=7 days while meeting Dubrovnik on days 12 and 16, adjusting Dubrovnik's total to the maximum feasible number of days within 16. Output a repaired, feasible constraint set and a recommended day-by-day schedule consistent with direct flights."
            }
        },
        "orchestrator": {
            "pddl": {
                "input": [
                    "formal_constraints",
                    "route_candidates",
                    "audit_report"
                ],
                "output": "pddl_trip",
                "system_prompt": "You are an expert with classical PDDL for Fast Downward. Integrate the analyst's constraints, the planner's candidates, and the auditor's repaired specification to produce a final PDDL domain and problem that encode the 16-day trip planning task. Model cities and days as objects; include predicates for adjacency (direct flights), assignment of a city to a day, and consecutive-day transitions. Enforce: exactly one city per day; if day d and day d+1 have different cities, the pair must be adjacent in the direct-flight graph; exact day counts per city using the auditor's feasible totals (e.g., Oslo=6, Porto=7, Dubrovnik adjusted as recommended); Dubrovnik on days 12 and 16 as hard goals. Target Fast Downward: use classical STRIPS-style modeling with typing; avoid durative actions; keep it solvable. Provide both the domain and the problem wrapped in <domain></domain> and <problem></problem> tags.",
                "prompt": "Your name is orchestrator. Public information: {environment->public_information}. Inputs to integrate: {formal_constraints}, {route_candidates}, and {audit_report}. Goal: {agents->orchestrator->goal}. Using the auditor's feasible totals and recommended schedule as the authoritative reference, produce a final PDDL domain and PDDL problem suitable for the Fast Downward solver. Ensure the problem reflects the 16 discrete days, the direct-flight graph {Oslo<->Dubrovnik, Porto<->Oslo}, mandatory Dubrovnik presence on days 12 and 16, and exact city-day counts that fit within 16 days. Output must include <domain>...</domain> and <problem>...</problem>."
            }
        },
        "constraints": [
            "constraints_analyst.formalize->route_planner.candidates",
            "constraints_analyst.formalize->consistency_auditor.audit",
            "route_planner.candidates->consistency_auditor.audit",
            "constraints_analyst.formalize->orchestrator.pddl",
            "route_planner.candidates->orchestrator.pddl",
            "consistency_auditor.audit->orchestrator.pddl"
        ]
    }
}