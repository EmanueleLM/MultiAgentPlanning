{
    "name": "TripPlanningExample8",
    "author": "Human",
    "agents": {
        "number": 4,
        "names": [
            "calendar_manager",
            "flight_mapper",
            "preference_resolver",
            "orchestrator"
        ],
        "calendar_manager": {
            "private_information": [
                "I specialize in partitioning timelines into contiguous blocks per location.",
                "I ensure total days match the trip length and honor fixed-date constraints."
            ],
            "goal": "Propose contiguous day ranges for each city that sum to 16 days, respect the Athens relatives window (days 1 through 7 inclusive), and minimize deviations from the user's desired stays."
        },
        "flight_mapper": {
            "private_information": [
                "I model transport connectivity as direct-flight edges.",
                "I verify that the proposed city order is realizable using only direct flights and suggest a corrected order when needed."
            ],
            "goal": "Ensure the itinerary city sequence follows only direct flights between consecutive cities, adjusting order if necessary."
        },
        "preference_resolver": {
            "private_information": [
                "I reconcile user preferences with hard constraints by minimizing total deviations.",
                "I prioritize hard constraints: total duration 16 days; Athens relatives window on days 1\u20137; only direct flights allowed between consecutive cities."
            ],
            "goal": "Finalize an itinerary that fits within 16 days, keeps Athens on days 1\u20137, and uses only direct flights, minimizing deviation from desired durations (Krakow 6, Athens 7, Zurich 5)."
        },
        "orchestrator": {
            "private_information": [
                "I integrate calendar, routing, and preference decisions into a single coherent plan.",
                "I produce a PDDL domain and problem targeting the FastDownward solver."
            ],
            "goal": "Coordinate agents to produce a 16-day trip plan across Athens, Zurich, and Krakow using only direct flights, with Athens scheduled within days 1\u20137, and emit a final PDDL domain and problem suitable for FastDownward."
        }
    },
    "environment": {
        "init": {
            "total_days": 16,
            "day_indexing": "Days are numbered 1 through 16",
            "cities": [
                "Athens",
                "Zurich",
                "Krakow"
            ]
        },
        "public_information": [
            "Trip length: 16 days total (days 1..16).",
            "Cities to visit: Athens, Zurich, Krakow.",
            "Direct flights exist between: Athens \u2194 Zurich, Zurich \u2194 Krakow.",
            "There is no direct flight between Athens and Krakow.",
            "You only take direct flights to commute between cities.",
            "Desired stays (soft preferences): Krakow 6 days, Athens 7 days, Zurich 5 days.",
            "Hard constraint: Visit relatives in Athens between day 1 and day 7 inclusive.",
            "Goal: Find a city order and contiguous day ranges per city that sum to 16 days and use only direct flights for inter-city moves."
        ]
    },
    "workflow": {
        "calendar_manager": {
            "calendar": {
                "input": [],
                "output": "calendar_plan",
                "system_prompt": "You are an expert travel calendar planner. Your task is to partition a 16-day timeline (days 1..16) into contiguous blocks assigned to Athens, Zurich, and Krakow. Respect the hard constraint that the Athens stay must occur entirely within days 1..7 inclusive. Treat the desired durations (Krakow 6, Athens 7, Zurich 5) as soft preferences. Propose a feasible allocation that sums exactly to 16 days and minimizes deviations from the desired durations. Output a single JSON object with keys: itinerary_blocks (list of objects with city, start_day, end_day, days), total_days, and notes. Do not emit PDDL.",
                "prompt": "Public info: {environment->public_information}. Produce a feasible contiguous-day allocation per city that sums to 16, places Athens within days 1..7, and acknowledges that only direct flights will be used for inter-city transitions. Prefer minimal total deviation from desired durations. Output JSON only under the specified keys."
            }
        },
        "flight_mapper": {
            "routes": {
                "input": [
                    "calendar_plan"
                ],
                "output": "flight_graph",
                "system_prompt": "You analyze route feasibility using direct-flight connectivity. Given a proposed calendar of city blocks, verify whether the city order is realizable using only direct flights. If not feasible, adjust the order while keeping Athens within days 1..7 and preserving the block lengths. Output a JSON object with keys: route (ordered list of cities), edges (list of [cityA, cityB] pairs that are direct flights), feasibility (true/false), adjustments (if any), and justification. Do not emit PDDL.",
                "prompt": "Public info: {environment->public_information}. Proposed calendar: {calendar_plan}. Ensure the city sequence can be traversed with only direct flights between consecutive cities (Athens \u2194 Zurich, Zurich \u2194 Krakow). If infeasible, propose a corrected sequence and explain."
            }
        },
        "preference_resolver": {
            "reconcile": {
                "input": [
                    "calendar_plan",
                    "flight_graph"
                ],
                "output": "resolved_preferences",
                "system_prompt": "You reconcile soft preferences with hard constraints to finalize the itinerary. Keep Athens scheduled within days 1..7, ensure total days sum to 16, and restrict inter-city transitions to direct flights only. Minimize total deviation from the desired durations (Krakow 6, Athens 7, Zurich 5). If a tie arises, prefer keeping Athens at 7 days and distribute remaining adjustments across Krakow and Zurich. Output JSON with keys: final_itinerary (list of blocks with city, start_day, end_day, days, in travel order), deviations (per city: desired vs final), and rationale. Do not emit PDDL.",
                "prompt": "Public info: {environment->public_information}. Proposed calendar: {calendar_plan}. Route analysis: {flight_graph}. Produce the finalized itinerary that satisfies all hard constraints and minimizes deviation from preferences. Output strictly in the specified JSON schema."
            }
        },
        "orchestrator": {
            "pddl": {
                "input": [
                    "calendar_plan",
                    "flight_graph",
                    "resolved_preferences"
                ],
                "output": "final_pddl",
                "system_prompt": "You are an expert with PDDL planning for the FastDownward solver. Integrate the proposed calendar, the verified route, and the reconciled preferences to produce a single-agent planning model for a traveler. The domain should include actions to stay one day in a city and to fly between cities only if a direct flight edge exists and day boundaries align. Represent the day timeline explicitly (e.g., day1..day16 with next relations). Ensure STRIPS-compatible PDDL (PDDL 2.1 level 1) suitable for FastDownward. Enclose the PDDL domain between <domain></domain> tags and the PDDL problem between <problem></problem> tags.",
                "prompt": "Goal: Create a 16-day trip plan visiting Athens, Zurich, and Krakow using only direct flights. Public info: {environment->public_information}. Proposed calendar: {calendar_plan}. Route feasibility: {flight_graph}. Finalized itinerary and deviations: {resolved_preferences}. Use the finalized itinerary as the authoritative target for the goal conditions. Model: objects for cities and days; predicates for at(city day), visited(city), next(day day), direct(city city), current-day(day); actions: stay-one-day(city d d+1) requiring current-day(d) and at(city d) to advance to d+1; fly(src dst d) at a block boundary requiring direct(src dst), current-day(d), and at(src d) to switch city for the next day; prevent flights between non-direct pairs; ensure the plan spans exactly 16 days and visits the cities in the specified order with contiguous stays. Output only the PDDL wrapped in the required tags."
            }
        },
        "constraints": [
            "calendar_manager.calendar->flight_mapper.routes",
            "calendar_manager.calendar->preference_resolver.reconcile",
            "flight_mapper.routes->preference_resolver.reconcile",
            "calendar_manager.calendar->orchestrator.pddl",
            "flight_mapper.routes->orchestrator.pddl",
            "preference_resolver.reconcile->orchestrator.pddl"
        ]
    }
}