(define (domain tripplanning)
  (:requirements :strips :typing :negative-preconditions)
  (:types city day token)
  (:predicates
    (next ?d - day ?nd - day)
    (current ?d - day)
    (assigned ?d - day)
    (at ?d - day ?c - city)
    (direct ?c1 - city ?c2 - city)
    (available ?t - token)
    (token-city ?t - token ?c - city)
    (must-santorini ?d - day)
    (amsterdam ?c - city)
    (santorini ?c - city)
    (istanbul ?c - city)
  )

  ; Assign the city for the current day (used to set Day 1); consumes exactly one city token
  (:action assign-start
    :parameters (?d - day ?c - city ?t - token)
    :precondition (and
      (current ?d)
      (not (assigned ?d))
      (available ?t)
      (token-city ?t ?c)
    )
    :effect (and
      (assigned ?d)
      (at ?d ?c)
      (not (available ?t))
    )
  )

  ; Stay in the same city for the next day when that next day is not restricted to Santorini
  (:action step-stay-general
    :parameters (?d - day ?nd - day ?c - city ?t - token)
    :precondition (and
      (current ?d)
      (assigned ?d)
      (at ?d ?c)
      (next ?d ?nd)
      (not (assigned ?nd))
      (not (must-santorini ?nd))
      (available ?t)
      (token-city ?t ?c)
    )
    :effect (and
      (assigned ?nd)
      (at ?nd ?c)
      (not (available ?t))
      (not (current ?d))
      (current ?nd)
    )
  )

  ; Fly along a direct edge to a different city for the next day (when next day is not restricted)
  (:action step-fly-general
    :parameters (?d - day ?nd - day ?from - city ?to - city ?t - token)
    :precondition (and
      (current ?d)
      (assigned ?d)
      (at ?d ?from)
      (next ?d ?nd)
      (not (assigned ?nd))
      (not (must-santorini ?nd))
      (available ?t)
      (token-city ?t ?to)
      (direct ?from ?to)
    )
    :effect (and
      (assigned ?nd)
      (at ?nd ?to)
      (not (available ?t))
      (not (current ?d))
      (current ?nd)
    )
  )

  ; Stay, but the next day must be Santorini (used for days 12-14)
  (:action step-stay-santorini
    :parameters (?d - day ?nd - day ?c - city ?t - token)
    :precondition (and
      (current ?d)
      (assigned ?d)
      (at ?d ?c)
      (next ?d ?nd)
      (not (assigned ?nd))
      (must-santorini ?nd)
      (santorini ?c)
      (available ?t)
      (token-city ?t ?c)
    )
    :effect (and
      (assigned ?nd)
      (at ?nd ?c)
      (not (available ?t))
      (not (current ?d))
      (current ?nd)
    )
  )

  ; Fly into Santorini for a restricted day (days 12-14)
  (:action step-fly-santorini
    :parameters (?d - day ?nd - day ?from - city ?to - city ?t - token)
    :precondition (and
      (current ?d)
      (assigned ?d)
      (at ?d ?from)
      (next ?d ?nd)
      (not (assigned ?nd))
      (must-santorini ?nd)
      (santorini ?to)
      (available ?t)
      (token-city ?t ?to)
      (direct ?from ?to)
    )
    :effect (and
      (assigned ?nd)
      (at ?nd ?to)
      (not (available ?t))
      (not (current ?d))
      (current ?nd)
    )
  )
)